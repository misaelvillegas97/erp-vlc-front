@use 'sass:map';
@use '@angular/material' as mat;
@use 'user-themes' as userThemes;

// Include the core Angular Material styles
@include mat.core();

// Function to create M3 palette from custom color map
@function create-m3-palette($color-map) {
    @return (
        0: #000000,
        10: map.get($color-map, 950),
        20: map.get($color-map, 900),
        25: map.get($color-map, 800),
        30: map.get($color-map, 700),
        40: map.get($color-map, 600),
        50: map.get($color-map, DEFAULT),
        60: map.get($color-map, 400),
        70: map.get($color-map, 300),
        80: map.get($color-map, 200),
        90: map.get($color-map, 100),
        95: map.get($color-map, 50),
        98: #fefefe,
        99: #ffffff,
        100: #ffffff,
        // Add required M3 palette properties
        neutral: (
            0: #000000,
            10: #1a1a1a,
            20: #2e2e2e,
            30: #424242,
            40: #616161,
            50: #757575,
            60: #9e9e9e,
            70: #bdbdbd,
            80: #e0e0e0,
            90: #f5f5f5,
            95: #fafafa,
            99: #ffffff,
            100: #ffffff,
        ),
        neutral-variant: (
            0: #000000,
            10: #1c1b1f,
            20: #313033,
            30: #484649,
            40: #605d62,
            50: #79767d,
            60: #938f96,
            70: #aea9b1,
            80: #cac5cd,
            90: #e7e0e8,
            95: #f5eff4,
            99: #fffbff,
            100: #ffffff,
        ),
        secondary: (
            0: #000000,
            10: #1d192b,
            20: #332d41,
            30: #4a4458,
            40: #625b71,
            50: #7a7289,
            60: #958da5,
            70: #b0a7c0,
            80: #ccc2dc,
            90: #e8def8,
            95: #f6edff,
            99: #fffbff,
            100: #ffffff,
        ),
        error: (
            0: #000000,
            10: #410e0b,
            20: #601410,
            30: #8c1d18,
            40: #b3261e,
            50: #dc362e,
            60: #e46962,
            70: #ec928e,
            80: #f2b8b5,
            90: #f9dedc,
            95: #fceeee,
            99: #fffbf9,
            100: #ffffff,
        ),
    );
}

// Custom color tokens for light and dark themes
$light-custom-tokens: (
    --mat-app-background-color: #f1f5f9,
    --mat-app-surface-color: #ddd,
    --mat-app-text-color: #1e293b,
    --mat-app-secondary-text-color: #64748b,
    --mat-divider-color: #e2e8f0,
    --mat-card-container-color: #ddd,
    --mat-dialog-container-color: #ddd,
    --mat-sidenav-container-color: #ddd,
    --mat-toolbar-container-color: #ddd,
    --mat-card-elevated-container-color: #ddd,
    --mat-table-background-color: #ddd
);

$dark-custom-tokens: (
    --mat-app-background-color: #0f172a,
    --mat-app-surface-color: #1e293b,
    --mat-app-text-color: #dddddd,
    --mat-app-secondary-text-color: #64748b,
    --mat-divider-color: rgba(241, 245, 249, 0.12),
    --mat-card-container-color: #1e293b,
    --mat-dialog-container-color: #1e293b,
    --mat-sidenav-container-color: #1e293b,
    --mat-toolbar-container-color: #0f172a,
    --mat-card-elevated-container-color: #1e293b,
    --mat-table-background-color: #1e293b
);

@each $theme-name, $theme in userThemes.$user-themes {
    // Extract color palettes from user theme
    $primary-colors: map.get($theme, primary);
    $accent-colors: map.get($theme, accent);
    $warn-colors: map.get($theme, warn);

    // Create M3 themes using built-in palettes as base
    $light-theme: mat.define-theme((
        color: (
            theme-type: light,
            primary: mat.$orange-palette,
            tertiary: mat.$blue-palette,
        ),
        typography: (
            brand-family: theme('fontFamily.sans'),
            plain-family: theme('fontFamily.sans'),
            bold-weight: 800,
            medium-weight: 600,
            regular-weight: 400,
        ),
        density: (
            scale: 0
        )
    ));

    $dark-theme: mat.define-theme((
        color: (
            theme-type: dark,
            primary: mat.$orange-palette,
            tertiary: mat.$blue-palette,
        ),
        typography: (
            brand-family: theme('fontFamily.sans'),
            plain-family: theme('fontFamily.sans'),
            bold-weight: 800,
            medium-weight: 600,
            regular-weight: 400,
        ),
        density: (
            scale: 0
        )
    ));

    // Apply themes with selectors and custom color overrides
    #{map.get($theme, selector)} .light,
    #{map.get($theme, selector)}.light {
        @include mat.all-component-themes($light-theme);

        // Apply custom color tokens
        @each $property, $value in $light-custom-tokens {
            #{$property}: #{$value};
        }

        // Override M3 colors with custom theme colors
        --mat-sys-primary: #{map.get($primary-colors, DEFAULT)};
        --mat-sys-on-primary: #{map.get(map.get($primary-colors, contrast), DEFAULT)};
        --mat-sys-primary-container: #{map.get($primary-colors, 100)};
        --mat-sys-on-primary-container: #{map.get(map.get($primary-colors, contrast), 100)};
        --mat-sys-tertiary: #{map.get($accent-colors, DEFAULT)};
        --mat-sys-on-tertiary: #{map.get(map.get($accent-colors, contrast), DEFAULT)};
        --mat-sys-error: #{map.get($warn-colors, DEFAULT)};
        --mat-sys-on-error: #{map.get(map.get($warn-colors, contrast), DEFAULT)};

        // Override component-specific colors
        --mdc-filled-button-container-color: #{map.get($primary-colors, DEFAULT)};
        --mdc-filled-button-label-text-color: #{map.get(map.get($primary-colors, contrast), DEFAULT)};
        --mdc-outlined-button-label-text-color: #{map.get($primary-colors, DEFAULT)};
        --mdc-outlined-button-outline-color: #{map.get($primary-colors, 200)};

        // Custom typography tokens matching M2 configuration
        // M2 headline-1 (1.875rem, 2.25rem, 800) -> M3 display-large
        --mat-sys-display-large-size: 1.875rem;
        --mat-sys-display-large-line-height: 2.25rem;
        --mat-sys-display-large-weight: 800;

        // M2 headline-2 (1.25rem, 1.75rem, 700) -> M3 headline-large
        --mat-sys-headline-large-size: 1.25rem;
        --mat-sys-headline-large-line-height: 1.75rem;
        --mat-sys-headline-large-weight: 700;

        // M2 headline-3 (1.125rem, 1.75rem, 600) -> M3 headline-medium
        --mat-sys-headline-medium-size: 1.125rem;
        --mat-sys-headline-medium-line-height: 1.75rem;
        --mat-sys-headline-medium-weight: 600;

        // M2 headline-4 (0.875rem, 1.25rem, 600) -> M3 headline-small
        --mat-sys-headline-small-size: 0.875rem;
        --mat-sys-headline-small-line-height: 1.25rem;
        --mat-sys-headline-small-weight: 600;

        // M2 headline-5 (0.875rem, 1.5rem, 400) -> M3 title-large
        --mat-sys-title-large-size: 0.875rem;
        --mat-sys-title-large-line-height: 1.5rem;
        --mat-sys-title-large-weight: 400;

        // M2 headline-6 (0.875rem, 1.5rem, 400) -> M3 title-medium
        --mat-sys-title-medium-size: 0.875rem;
        --mat-sys-title-medium-line-height: 1.5rem;
        --mat-sys-title-medium-weight: 400;

        // M2 subtitle-1 (1rem, 1.75rem, 400) -> M3 title-small
        --mat-sys-title-small-size: 1rem;
        --mat-sys-title-small-line-height: 1.75rem;
        --mat-sys-title-small-weight: 400;

        // M2 subtitle-2 (0.875rem, 1.25rem, 600) -> M3 label-large
        --mat-sys-label-large-size: 0.875rem;
        --mat-sys-label-large-line-height: 1.25rem;
        --mat-sys-label-large-weight: 600;

        // M2 body-1 (0.875rem, 1.5rem, 400) -> M3 body-large
        --mat-sys-body-large-size: 0.875rem;
        --mat-sys-body-large-line-height: 1.5rem;
        --mat-sys-body-large-weight: 400;

        // M2 body-2 (0.875rem, 1.5rem, 400) -> M3 body-medium
        --mat-sys-body-medium-size: 0.875rem;
        --mat-sys-body-medium-line-height: 1.5rem;
        --mat-sys-body-medium-weight: 400;

        // M2 caption (0.75rem, 1rem, 400) -> M3 body-small
        --mat-sys-body-small-size: 0.75rem;
        --mat-sys-body-small-line-height: 1rem;
        --mat-sys-body-small-weight: 400;

        // M2 button (0.875rem, 0.875rem, 500) -> M3 label-medium
        --mat-sys-label-medium-size: 0.875rem;
        --mat-sys-label-medium-line-height: 0.875rem;
        --mat-sys-label-medium-weight: 500;

        // M2 overline (0.75rem, 2rem, 500) -> M3 label-small
        --mat-sys-label-small-size: 0.75rem;
        --mat-sys-label-small-line-height: 2rem;
        --mat-sys-label-small-weight: 500;

        --mat-form-field-filled-label-text-size: 0.875rem;

    }

    #{map.get($theme, selector)} .dark,
    #{map.get($theme, selector)}.dark {
        @include mat.all-component-themes($dark-theme);

        // Apply custom color tokens
        @each $property, $value in $dark-custom-tokens {
            #{$property}: #{$value};
        }

        // Override M3 colors with custom theme colors for dark mode
        --mat-sys-primary: #{map.get($primary-colors, 400)};
        --mat-sys-on-primary: #{map.get(map.get($primary-colors, contrast), 400)};
        --mat-sys-primary-container: #{map.get($primary-colors, 800)};
        --mat-sys-on-primary-container: #{map.get(map.get($primary-colors, contrast), 800)};
        --mat-sys-tertiary: #{map.get($accent-colors, 400)};
        --mat-sys-on-tertiary: #{map.get(map.get($accent-colors, contrast), 400)};
        --mat-sys-error: #{map.get($warn-colors, 400)};
        --mat-sys-on-error: #{map.get(map.get($warn-colors, contrast), 400)};

        // Override component-specific colors for dark mode
        --mdc-filled-button-container-color: #{map.get($primary-colors, 600)};
        --mdc-filled-button-label-text-color: #{map.get(map.get($primary-colors, contrast), 600)};
        --mdc-outlined-button-label-text-color: #{map.get($primary-colors, 400)};
        --mdc-outlined-button-outline-color: #{map.get($primary-colors, 700)};

        // Custom typography tokens matching M2 configuration (dark mode)
        // M2 headline-1 (1.875rem, 2.25rem, 800) -> M3 display-large
        --mat-sys-display-large-size: 1.875rem;
        --mat-sys-display-large-line-height: 2.25rem;
        --mat-sys-display-large-weight: 800;

        // M2 headline-2 (1.25rem, 1.75rem, 700) -> M3 headline-large
        --mat-sys-headline-large-size: 1.25rem;
        --mat-sys-headline-large-line-height: 1.75rem;
        --mat-sys-headline-large-weight: 700;

        // M2 headline-3 (1.125rem, 1.75rem, 600) -> M3 headline-medium
        --mat-sys-headline-medium-size: 1.125rem;
        --mat-sys-headline-medium-line-height: 1.75rem;
        --mat-sys-headline-medium-weight: 600;

        // M2 headline-4 (0.875rem, 1.25rem, 600) -> M3 headline-small
        --mat-sys-headline-small-size: 0.875rem;
        --mat-sys-headline-small-line-height: 1.25rem;
        --mat-sys-headline-small-weight: 600;

        // M2 headline-5 (0.875rem, 1.5rem, 400) -> M3 title-large
        --mat-sys-title-large-size: 0.875rem;
        --mat-sys-title-large-line-height: 1.5rem;
        --mat-sys-title-large-weight: 400;

        // M2 headline-6 (0.875rem, 1.5rem, 400) -> M3 title-medium
        --mat-sys-title-medium-size: 0.875rem;
        --mat-sys-title-medium-line-height: 1.5rem;
        --mat-sys-title-medium-weight: 400;

        // M2 subtitle-1 (1rem, 1.75rem, 400) -> M3 title-small
        --mat-sys-title-small-size: 1rem;
        --mat-sys-title-small-line-height: 1.75rem;
        --mat-sys-title-small-weight: 400;

        // M2 subtitle-2 (0.875rem, 1.25rem, 600) -> M3 label-large
        --mat-sys-label-large-size: 0.875rem;
        --mat-sys-label-large-line-height: 1.25rem;
        --mat-sys-label-large-weight: 600;

        // M2 body-1 (0.875rem, 1.5rem, 400) -> M3 body-large
        --mat-sys-body-large-size: 0.875rem;
        --mat-sys-body-large-line-height: 1.5rem;
        --mat-sys-body-large-weight: 400;

        // M2 body-2 (0.875rem, 1.5rem, 400) -> M3 body-medium
        --mat-sys-body-medium-size: 0.875rem;
        --mat-sys-body-medium-line-height: 1.5rem;
        --mat-sys-body-medium-weight: 400;

        // M2 caption (0.75rem, 1rem, 400) -> M3 body-small
        --mat-sys-body-small-size: 0.75rem;
        --mat-sys-body-small-line-height: 1rem;
        --mat-sys-body-small-weight: 400;

        // M2 button (0.875rem, 0.875rem, 500) -> M3 label-medium
        --mat-sys-label-medium-size: 0.875rem;
        --mat-sys-label-medium-line-height: 0.875rem;
        --mat-sys-label-medium-weight: 500;

        // M2 overline (0.75rem, 2rem, 500) -> M3 label-small
        --mat-sys-label-small-size: 0.75rem;
        --mat-sys-label-small-line-height: 2rem;
        --mat-sys-label-small-weight: 500;

        --mat-form-field-filled-label-text-size: 0.875rem;
    }
}
