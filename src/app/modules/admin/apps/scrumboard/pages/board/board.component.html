<!-- Trello-like Board Container with Optimized Background -->
<div class="relative flex min-w-0 flex-col overflow-hidden scrumboard-bg w-full">
    <!-- Optimized Background Pattern -->
    <div class="absolute inset-0 scrumboard-bg-pattern"></div>

    <!-- Board Header Component -->
    <scrumboard-board-header
        [board]="board()"
        (addMember)="onAddMember()"
        (editBoard)="onEditBoard()"
        (changeBackground)="onChangeBackground()"
        (archiveBoard)="onArchiveBoard()"
        (deleteBoard)="onDeleteBoard()">
    </scrumboard-board-header>

    <!-- Board Navigation Component -->
    @defer (on idle) {
        <scrumboard-board-navigation [boardTitle]="boardTitle()"></scrumboard-board-navigation>
    } @placeholder {
        <div class="relative z-10 flex items-center justify-between px-3 sm:px-6 lg:px-8 py-2 sm:py-3 bg-black/10 backdrop-blur-sm">
            <div class="w-32 h-4 bg-white/20 rounded animate-pulse"></div>
            <div class="w-24 h-4 bg-white/20 rounded animate-pulse"></div>
        </div>
    }

    <!-- Main -->
    <div cdkScrollable class="relative z-10 flex-auto overflow-y-visible sm:overflow-y-auto p-3 sm:p-6 lg:p-8 sm:pt-4">
        <!-- Lists -->
        <div
            (cdkDropListDropped)="listDropped($event)"
            [cdkDropListData]="boardLists()"
            cdkDropList
            cdkDropListOrientation="horizontal"
            class="flex h-full flex-nowrap items-start p-2 sm:p-4 overflow-x-auto relative z-10 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600 scrollbar-track-transparent scrollbar-thumb-rounded-full scrollbar-track-rounded-full touch-pan-x"
        >
            <!-- Group all cdkDropList's after this point together so that the cards can be transferred between lists -->
            <div cdkDropListGroup class="flex items-start space-x-2 sm:space-x-4">
                <!-- List Components -->
                @for (list of boardLists(); track trackByFn($index, list)) {
                    <scrumboard-board-list
                        [list]="list"
                        (updateListTitle)="updateListTitle($event.event, $event.list)"
                        (renameList)="renameList($event)"
                        (editListProperties)="editListProperties($event)"
                        (deleteList)="deleteList($event)"
                        (addCard)="addCard($event.list, $event.title)"
                        (cardDropped)="cardDropped($event)">
                    </scrumboard-board-list>
                }

                <!-- New list -->
                @defer (on idle) {
                    <scrumboard-board-add-list
                        (saved)="addList($event)"
                        [buttonTitle]="addListButtonTitle()"
                    >
                    </scrumboard-board-add-list>
                } @placeholder {
                    <div class="w-64 sm:w-72 p-3 sm:p-4 bg-white/10 backdrop-blur-sm rounded-lg border border-white/20">
                        <div class="w-32 h-4 bg-white/20 rounded animate-pulse"></div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Invisible router-outlet for ScrumboardCard component -->
<div class="pointer-events-none invisible absolute h-0 w-0 opacity-0">
    <router-outlet></router-outlet>
</div>
